# Blockcode：一个可视化编程工具

Dethe是一个极客老爸，也是一个具有审美的程序员和导师，他创造了[Waterbear](http://www.waterbearlang.com)这个可视化编程工具。他参与主办了Vancouver Maker  Education沙龙，他还一直想把机器折纸兔塞满整个世界。

在基于块编程的编程语言中，我们通过拖拽和连接代表了程序的一部分的块来编写程序。大部分的编程语言区分大小写，语法比较晦涩难懂，并且比如在你把分号写错了位置，或者更糟糕的情况，遗漏了一个分号时，它会拒绝运行（所以你为啥如此傲娇）。并且，现在使用的大部分编程语言使用的是英语，语法不能本土化。

作为对比，一个优秀的块编程语言可以完全消除语法错误。你写的程序有可能仍然没有很好地实现功能，但它绝对不会有语法错误，因为块编程是完全不会允许这样的情况发生的。块编程语言更容易被发现，你可以直接就在块的列表里看到所有的结构和库。并且，块可以在不改变编程语言含义的情况下被本地化为所有的人类语言。

![1.1](D:\maoyanan\500-lines-or-less-\pic\1.1.png)

基于块的编程语言由来已久，比较突出的代表有[Lego Mindstorms](https://www.lego.com/en-us/mindstorms/),[Alice 3D](http://www.alice.org/),[StarLogo](https://education.mit.edu/projects/starlogo-tng),特别是[Scratch](https://scratch.mit.edu/)。同时网上也有一些块编程语言的开发工具，比如[Blockly](https://developers.google.com/blockly/)，[AppInventor](http://appinventor.mit.edu/explore/)，[Tynker](https://www.tynker.com/)和[其他](https://en.wikipedia.org/wiki/Visual_programming_language)。

这篇文章里的代码大致上基于开源的项目[Waterbear](http://waterbearlang.com/)，Waterbear是一个用块的语法来包装现存编程语言的工具，而不是一种语言。这样包装起来的好处除了前面提到的消除语法错误、可使用组件的可视化展示、便于本地化，还有就是可视化的代码在一些时候更容易阅读和进行调试，而且那些提前学习代码的娃娃们也可以使用（我们甚至可以更进一步地用图标和块的名字来标注块，或者直接用图标来代替块的名字，让那些不会写字的孩子们可以通过图标来写自己的程序，但在本文中我们并没有涉及到这个方面）。

python里面的海龟绘图的使用，还要归因于Logo编程语言，因为Logo是专门用来教孩子们来学习编程的。之前提到的块编程语言有几种使用了海龟绘图，并且是在一个像这样的强约束的项目里能捕获到的非常小的域名？

如果你想要深入了解一个基于块的编程语言是什么样的，你可以自己动手练习一下这篇文章里的项目，[项目GitHub地址](https://dethe.github.io/500lines/blockcode/)。

## 目标和文章结构

我想要通过这个代码实现一些功能。首先，我要完成海龟绘图的块编程，通过块编程，我们可以使用尽可能简单的HTML,CSS,JavaScript结构的代码来通过简单的拖拽和放置块来生成镜像。还有很重要的一点，我想要给大家展示一下块编程是怎样作为一个架构来为除了海龟绘图的其他语言来提供服务的。

为了实现这些，我们把代码里所有专属于海龟绘图的部分封装到turtlr.js文件里，并且可以很容易得把这个文件换成其他的。剩余的部分都不是专属于海龟语言的，有关于块的block.js和menu.js，和通用的网络实用工具的util.js，drag.js，file.js 。这就是我的目标，虽然为了让项目不要变得很大，一些网络实用工具其实并没有那么通用，他们与块的使用有一定的相关性。

当我写一个块语言的时候，我感受最深的一点的是它是自己的IDE。你不能随便就选一个自己最喜欢的编辑器来写块代码，IDE必须和块语言本身一起去设计和实现的。这样的做法有好处也有坏处，好处是大家必须使用同一种环境来写代码，程序员们就不会为了到底哪个编辑器更好用的问题吵个不停。坏处是除了构建块语言本身，还要花费额外的精力去关注IDE。

## 脚本的本质

一个块编程的脚本，就像所有的不管是基于块的或者基于文本的编程语言，都是给计算机去执行的操作序列。在块编码中，脚本由嵌套使用的html元素块组成，并且每个块上有各自定义的JavaScript函数。一个块可以包含并且控制其他的块，还可以包含传递给JavaScript函数的数字型参数。

在基于文本的大多数编程语言里，一个脚本会经历下面几个阶段：



l